## @file test_All.py
#  @author Rizwan Ahsan, ahsanm7
#  @brief Contains methods for testing all modules in the file
#  @date 16/02/2021
#  @details Tests Shape, CircleT, TriangleT, BodyT, Scene and Plot

import pytest
from CircleT import CircleT
from TriangleT import TriangleT
from BodyT import BodyT
from Scene import Scene
from Plot import plot


class TestCircleT():

    def setup_method(self, method):
        self.c = CircleT(1.0, 10.0, 0.5, 1.0)

    def teardown_method(self, method):
        self.c = None

    def test_cmx(self):
        assert self.c.cm_x() == 1.0

    def test_cmy(self):
        assert self.c.cm_y() == 10.0

    def test_mass(self):
        assert self.c.mass() == 1.0

    def test_m_inert(self):
        assert self.c.m_inert() == 1.0 * 0.5 ** 2 / 2

    def test_error(self):
        with pytest.raises(ValueError):
            CircleT(1.0, 10.0, -0.5, -2.0)


class TestTriangleT():

    def setup_method(self, method):
        self.t = TriangleT(1.0, -10.0, 5, 17.5)

    def teardown_method(self, method):
        self.t = None

    def test_cmx(self):
        assert self.t.cm_x() == 1.0

    def test_cmy(self):
        assert self.t.cm_y() == -10.0

    def test_mass(self):
        assert self.t.mass() == 17.5

    def test_m_inert(self):
        assert self.t.m_inert() == 17.5 * 5 ** 2 / 12

    def test_error(self):
        with pytest.raises(ValueError):
            TriangleT(2.0, 0.0, -1.0, 5.0)


class TestBodyT():

    def setup_method(self, method):
        self.b = BodyT([11, 9, 9, 11], [11, 11, 9, 9], [10, 10, 10, 10])

    def teardown_method(self, method):
        self.b = None

    def test_cmx(self):
        assert self.b.cm_x() == 10

    def test_cmy(self):
        assert self.b.cm_y() == 10

    def test_mass(self):
        assert self.b.mass() == 40

    def test_m_inert(self):
        assert self.b.m_inert() == 80

    def test_error1(self):
        with pytest.raises(ValueError):
            BodyT([11, 9, 9, 11], [11, 11, 9, 9], [10, 10, 10])

    def test_error2(self):
        with pytest.raises(ValueError):
            BodyT([11, 9, 9, 11], [11, 11, 9, 9], [10, 10, 10, -20])


class TestScene():

    def setup_method(self, method):
        self.t = TriangleT(1.0, -10.0, 5, 17.5)
        self.g = 9.81
        self.m = 1
        self.s = Scene(self.t, self.Fx, self.Fy, 10, 20)

    def teardown_method(self, method):
        self.t1 = None

    def Fx(self, t):
        return 5 if t < 5 else 0

    def Fy(self, t):
        return -self.g * self.m if t < 3 else self.g * self.m

    def test_get_shape(self):
        assert self.s.get_shape() == self.t

    def test_get_init_val(self):
        assert self.s.get_init_velo() == (10, 20)

    def test_set_init_val(self):
        self.s.set_init_velo(0, 0)
        assert self.s.get_init_velo() == (0, 0)

    def test_set_shape(self):
        a = CircleT(1.0, 10.0, 0.5, 1.0)
        self.s.set_shape(a)
        assert self.s.get_shape() == a

    def sim_values(self):
        t_calc, wsol = self.s.sim(10, 50)
        w_calc = []
        for w1 in wsol:
            w_calc.append([w1[0], w1[1], w1[2], w1[3]])

        t_true = [0.0, 0.20408163265306123, 0.40816326530612246, 0.6122448979591837,
                  0.8163265306122449, 1.0204081632653061, 1.2244897959183674, 1.4285714285714286,
                  1.6326530612244898, 1.836734693877551, 2.0408163265306123, 2.2448979591836733,
                  2.4489795918367347, 2.6530612244897958, 2.857142857142857, 3.061224489795918,
                  3.2653061224489797, 3.4693877551020407, 3.673469387755102, 3.877551020408163,
                  4.081632653061225, 4.285714285714286, 4.489795918367347, 4.6938775510204085,
                  4.8979591836734695, 5.1020408163265305, 5.3061224489795915, 5.510204081632653,
                  5.714285714285714, 5.918367346938775, 6.122448979591836, 6.326530612244898,
                  6.530612244897959, 6.73469387755102, 6.938775510204081, 7.142857142857143,
                  7.346938775510204, 7.551020408163265, 7.755102040816326, 7.959183673469388,
                  8.16326530612245, 8.36734693877551, 8.571428571428571, 8.775510204081632,
                  8.979591836734693, 9.183673469387756, 9.387755102040817, 9.591836734693878,
                  9.795918367346939, 10.0]

        w_true = [[1.0, 10.0, 0.0, 0.0],
                  [1.10412328258546, 9.795710119567326, 1.0204081632653061, -2.0020408163265304],
                  [1.416493128483002, 9.18284048191635, 2.040816326530612, -4.004081632653062],
                  [1.9371095383122396, 8.161391085831385, 3.0612244897959187, -6.006122448979593],
                  [2.665972512073173, 6.731361931312434, 4.081632653061225, -8.008163265306123],
                  [3.603082049765802, 4.892753018359498, 5.1020408163265305, -10.010204081632654],
                  [4.748438151390126, 2.645564346972576, 6.122448979591836, -12.012244897959185],
                  [6.102040816946145, -0.010204082848332074, 7.142857142857142, -14.014285714285714],
                  [7.663890046433865, -3.074552271103233, 8.163265306122451, -16.016326530612247],
                  [9.433985839853273, -6.547480217792112, 9.183673469387756, -18.018367346938778],
                  [11.41232819720438, -10.428987922914978, 10.204081632653063, -20.02040816326531],
                  [13.598917118487176, -14.719075386471825, 11.224489795918368, -22.022448979591836],
                  [15.993752603701672, -19.417742608462667, 12.244897959183675, -24.02448979591837],
                  [18.596834652847857, -24.524989588887475, 13.265306122448981, -26.026530612244898],
                  [21.408163265925747, -30.0408163277463, 14.285714285714288, -28.028571428571436],
                  [24.427738916534295, -35.928451567707256, 15.306122448979593, -28.82938761996386],
                  [27.655560657475576, -41.60771018236045, 16.326530612244902, -26.827346803637326],
                  [31.091628962348537, -46.878389038579634, 17.346938775510203, -24.8253059873108],
                  [34.73594383115321, -51.74048813636485, 18.367346938775512, -22.823265170984268],
                  [38.588505263889566, -56.19400747571607, 19.387755102040817, -20.821224354657737],
                  [42.64931326055763, -60.23894705663334, 20.408163265306133, -18.8191835383312],
                  [46.918367821157375, -63.875306879116586, 21.428571428571434, -16.81714272200467],
                  [51.39566894568879, -67.10308694316583, 22.448979591836732, -14.815101905678157],
                  [56.081216634151936, -69.92228724878112, 23.469387755102037, -12.813061089351622],
                  [60.975010886546784, -72.33290779596243, 24.489795918367353, -10.811020273025086],
                  [66.05102279679654, -74.33494507893066, 25.000001250241873, -8.808979456698568],
                  [71.15306386827447, -75.928406109244, 25.000001250241873, -6.806938640372042],
                  [76.25510493975241, -77.11328738112334, 25.000001250241873, -4.804897824045504],
                  [81.35714601123036, -77.88958889456869, 25.000001250241873, -2.802857007718976],
                  [86.45918708270828, -78.25731064958006, 25.000001250241873, -0.8008161913924476],
                  [91.5612281541862, -78.21645264615745, 25.000001250241873, 1.2012246249340786],
                  [96.66326922566415, -77.76701488430085, 25.000001250241873, 3.2032654412606156],
                  [101.76531029714208, -76.90899736401026, 25.000001250241873, 5.205306257587145],
                  [106.86735136861999, -75.64240008528569, 25.000001250241873, 7.207347073913669],
                  [111.96939244009792, -73.96722304812712, 25.000001250241873, 9.209387890240198],
                  [117.07143351157588, -71.88346625253457, 25.000001250241873, 11.211428706566736],
                  [122.1734745830538, -69.39112969850804, 25.000001250241873, 13.213469522893265],
                  [127.2755156545317, -66.49021338604754, 25.000001250241873, 15.215510339219785],
                  [132.37755672600963, -63.18071731515305, 25.000001250241873, 17.217551155546314],
                  [137.47959779748757, -59.46264148582455, 25.000001250241873, 19.219591971872852],
                  [142.5816388689655, -55.335985898062084, 25.000001250241873, 21.22163278819938],
                  [147.68367994044343, -50.80075055186563, 25.000001250241873, 23.22367360452591],
                  [152.78572101192137, -45.856935447235195, 25.000001250241873, 25.225714420852437],
                  [157.88776208339928, -40.50454058417077, 25.000001250241873, 27.227755237178965],
                  [162.98980315487725, -34.743565962672335, 25.000001250241873, 29.2297960535055],
                  [168.09184422635522, -28.574011582739885, 25.000001250241873, 31.231836869832044],
                  [173.19388529783316, -21.995877444373505, 25.000001250241873, 33.23387768615858],
                  [178.29592636931108, -15.009163547573152, 25.000001250241873, 35.235918502485106],
                  [183.397967440789, -7.613869892338798, 25.000001250241873, 37.23795931881163],
                  [188.50000851226693, 0.1900035213295581, 25.000001250241873, 39.24000013513816]]

        return t_calc, t_true, w_calc, w_true

    def test_sim1(self):
        tc, tt = self.sim_values()[0], self.sim_values()[1]
        num = []
        for i in range(len(tc)):
            num.append(tc[i] - tt[i])

        assert (max(num) / max(tt)) < 0.005
